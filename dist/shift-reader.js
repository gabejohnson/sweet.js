"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _tokenizer = require("shift-parser/dist/tokenizer");

var _tokenizer2 = _interopRequireDefault(_tokenizer);

var _immutable = require("immutable");

var _syntax = require("./syntax");

var _syntax2 = _interopRequireDefault(_syntax);

var _ramdaFantasy = require("ramda-fantasy");

var _errors = require("./errors");

var _terms = require("./terms");

var _terms2 = _interopRequireDefault(_terms);

var _ramda = require("ramda");

var R = _interopRequireWildcard(_ramda);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const Just_623 = _ramdaFantasy.Maybe.Just;
const Nothing_624 = _ramdaFantasy.Maybe.Nothing;
const LSYNTAX_625 = { name: "left-syntax" };
const RSYNTAX_626 = { name: "right-syntax" };
const AT_627 = { klass: _tokenizer.TokenClass.Punctuator, name: "@" };
const literalKeywords_628 = ["this", "null", "true", "false"];
const isLeftBracket_629 = R.whereEq({ type: _tokenizer.TokenType.LBRACK });
const isLeftBrace_630 = R.whereEq({ type: _tokenizer.TokenType.LBRACE });
const isLeftParen_631 = R.whereEq({ type: _tokenizer.TokenType.LPAREN });
const isRightBracket_632 = R.whereEq({ type: _tokenizer.TokenType.RBRACK });
const isRightBrace_633 = R.whereEq({ type: _tokenizer.TokenType.RBRACE });
const isRightParen_634 = R.whereEq({ type: _tokenizer.TokenType.RPAREN });
const isEOS_635 = R.whereEq({ type: _tokenizer.TokenType.EOS });
const isHash_636 = R.whereEq({ type: _tokenizer.TokenType.IDENTIFIER, value: "#" });
const isLeftSyntax_637 = R.whereEq({ type: LSYNTAX_625 });
const isRightSyntax_638 = R.whereEq({ type: RSYNTAX_626 });
const isLeftDelimiter_639 = R.anyPass([isLeftBracket_629, isLeftBrace_630, isLeftParen_631, isLeftSyntax_637]);
const isRightDelimiter_640 = R.anyPass([isRightBracket_632, isRightBrace_633, isRightParen_634, isRightSyntax_638]);
const isMatchingDelimiters_641 = R.cond([[isLeftBracket_629, (__682, b_683) => isRightBracket_632(b_683)], [isLeftBrace_630, (__684, b_685) => isRightBrace_633(b_685)], [isLeftParen_631, (__686, b_687) => isRightParen_634(b_687)], [isLeftSyntax_637, (__688, b_689) => isRightSyntax_638(b_689)], [R.T, R.F]]);
const assignOps_642 = ["=", "+=", "-=", "*=", "/=", "%=", "<<=", ">>=", ">>>=", "&=", "|=", "^=", ","];
const binaryOps_643 = ["+", "-", "*", "/", "%", "<<", ">>", ">>>", "&", "|", "^", "&&", "||", "?", ":", "===", "==", ">=", "<=", "<", ">", "!=", "!==", "instanceof"];
const unaryOps_644 = ["++", "--", "~", "!", "delete", "void", "typeof", "yield", "throw", "new"];
const isEmpty_645 = R.whereEq({ size: 0 });
const isPunctuator_646 = s_690 => s_690.match("punctuator");
const isKeyword_647 = s_691 => s_691.match("keyword");
const isDelimiter_648 = s_692 => s_692.match("delimiter");
const isParens_649 = s_693 => s_693.match("parens");
const isBraces_650 = s_694 => s_694.match("braces");
const isBrackets_651 = s_695 => s_695.match("brackets");
const isIdentifier_652 = s_696 => s_696.match("identifier");
const val_653 = s_697 => s_697.val();
const isVal_654 = R.curry((v_698, s_699) => s_699.val() === v_698);
const isDot_655 = R.allPass([isPunctuator_646, isVal_654(".")]);
const isColon_656 = R.allPass([isPunctuator_646, isVal_654(":")]);
const isFunctionKeyword_657 = R.allPass([isKeyword_647, isVal_654("function")]);
const isOperator_658 = s_700 => (s_700.match("punctuator") || s_700.match("keyword")) && R.any(R.equals(s_700.val()), assignOps_642.concat(binaryOps_643).concat(unaryOps_644));
const isNonLiteralKeyword_659 = R.allPass([isKeyword_647, s_701 => R.none(R.equals(s_701.val()), literalKeywords_628)]);
const isKeywordExprPrefix_660 = R.allPass([isKeyword_647, s_702 => R.any(R.equals(s_702.val()), ["instanceof", "typeof", "delete", "void", "yield", "throw", "new", "case"])]);
let last_661 = p_703 => p_703.last();
let safeLast_662 = R.pipe(R.cond([[isEmpty_645, R.always(Nothing_624())], [R.T, R.compose(_ramdaFantasy.Maybe.of, last_661)]]));
let stuffTrue_663 = R.curry((p_704, b_705) => b_705 ? Just_623(p_704) : Nothing_624());
let stuffFalse_664 = R.curry((p_706, b_707) => !b_707 ? Just_623(p_706) : Nothing_624());
let isTopColon_665 = R.pipe(safeLast_662, R.map(isColon_656), _ramdaFantasy.Maybe.maybe(false, R.identity));
let isTopPunctuator_666 = R.pipe(safeLast_662, R.map(isPunctuator_646), _ramdaFantasy.Maybe.maybe(false, R.identity));
let isExprReturn_667 = R.curry((l_708, p_709) => {
  let retKwd_710 = safeLast_662(p_709);
  let maybeDot_711 = pop_678(p_709).chain(safeLast_662);
  if (maybeDot_711.map(isDot_655).getOrElse(false)) {
    return true;
  }
  return retKwd_710.map(s_712 => {
    return s_712.match("keyword") && s_712.val() === "return" && s_712.lineNumber() === l_708;
  }).getOrElse(false);
});
const isTopOperator_668 = R.pipe(safeLast_662, R.map(isOperator_658), _ramdaFantasy.Maybe.maybe(false, R.identity));
const isTopKeywordExprPrefix_669 = R.pipe(safeLast_662, R.map(isKeywordExprPrefix_660), _ramdaFantasy.Maybe.maybe(false, R.identity));
let isExprPrefix_670 = R.curry((l_713, b_714) => R.cond([[isEmpty_645, R.always(b_714)], [isTopColon_665, R.always(b_714)], [isTopKeywordExprPrefix_669, R.T], [isTopOperator_668, R.T], [isTopPunctuator_666, R.always(b_714)], [isExprReturn_667(l_713), R.T], [R.T, R.F]]));
let curly_671 = p_715 => safeLast_662(p_715).map(isBraces_650).chain(stuffTrue_663(p_715));
let paren_672 = p_716 => safeLast_662(p_716).map(isParens_649).chain(stuffTrue_663(p_716));
let func_673 = p_717 => safeLast_662(p_717).map(isFunctionKeyword_657).chain(stuffTrue_663(p_717));
let ident_674 = p_718 => safeLast_662(p_718).map(isIdentifier_652).chain(stuffTrue_663(p_718));
let nonLiteralKeyword_675 = p_719 => safeLast_662(p_719).map(isNonLiteralKeyword_659).chain(stuffTrue_663(p_719));
let opt_676 = R.curry((a_720, b_721, p_722) => {
  let result_723 = R.pipeK(a_720, b_721)(_ramdaFantasy.Maybe.of(p_722));
  return _ramdaFantasy.Maybe.isJust(result_723) ? result_723 : _ramdaFantasy.Maybe.of(p_722);
});
let notDot_677 = R.ifElse(R.whereEq({ size: 0 }), Just_623, p_724 => safeLast_662(p_724).map(s_725 => !(s_725.match("punctuator") && s_725.val() === ".")).chain(stuffTrue_663(p_724)));
let pop_678 = R.compose(Just_623, p_726 => p_726.pop());
const functionPrefix_679 = R.pipeK(curly_671, pop_678, paren_672, pop_678, opt_676(ident_674, pop_678), func_673);
const isRegexPrefix_680 = b_727 => R.anyPass([isEmpty_645, isTopPunctuator_666, R.pipe(_ramdaFantasy.Maybe.of, R.pipeK(nonLiteralKeyword_675, pop_678, notDot_677), _ramdaFantasy.Maybe.isJust), R.pipe(_ramdaFantasy.Maybe.of, R.pipeK(paren_672, pop_678, nonLiteralKeyword_675, pop_678, notDot_677), _ramdaFantasy.Maybe.isJust), R.pipe(_ramdaFantasy.Maybe.of, functionPrefix_679, R.chain(p_728 => {
  return safeLast_662(p_728).map(s_729 => s_729.lineNumber()).chain(fnLine_730 => {
    return pop_678(p_728).map(isExprPrefix_670(fnLine_730, b_727));
  }).chain(stuffFalse_664(p_728));
}), _ramdaFantasy.Maybe.isJust), p_731 => {
  let isCurly_732 = _ramdaFantasy.Maybe.isJust(safeLast_662(p_731).map(isBraces_650));
  let alreadyCheckedFunction_733 = R.pipe(_ramdaFantasy.Maybe.of, functionPrefix_679, _ramdaFantasy.Maybe.isJust)(p_731);
  if (alreadyCheckedFunction_733) {
    return false;
  }
  return R.pipe(_ramdaFantasy.Maybe.of, R.chain(curly_671), R.chain(p_734 => {
    return safeLast_662(p_734).map(s_735 => s_735.lineNumber()).chain(curlyLine_736 => {
      return pop_678(p_734).map(isExprPrefix_670(curlyLine_736, b_727));
    }).chain(stuffFalse_664(p_734));
  }), _ramdaFantasy.Maybe.isJust)(p_731);
}]);
function lastEl_681(l_737) {
  return l_737[l_737.length - 1];
}
class Reader extends _tokenizer2.default {
  constructor(strings_738, context_739, replacements_740) {
    super(Array.isArray(strings_738) ? strings_738.join("") : strings_738);
    this.delimStack = new Map();
    this.insideSyntaxTemplate = [false];
    this.context = context_739;
    if (Array.isArray(strings_738)) {
      let totalIndex = 0;
      this.replacementIndex = R.reduce((acc_741, strRep_742) => {
        acc_741.push({ index: totalIndex + strRep_742[0].length, replacement: strRep_742[1] });
        totalIndex += strRep_742[0].length;
        return acc_741;
      }, [], R.zip(strings_738, replacements_740));
    }
  }
  read() {
    let stack_743 = arguments.length <= 0 || arguments[0] === undefined ? [] : arguments[0];
    let b_744 = arguments.length <= 1 || arguments[1] === undefined ? false : arguments[1];
    let singleDelimiter_745 = arguments.length <= 2 || arguments[2] === undefined ? false : arguments[2];

    let prefix_746 = (0, _immutable.List)();
    while (true) {
      let tok = this.advance(prefix_746, b_744);
      if (tok instanceof _syntax2.default || tok instanceof _terms2.default) {
        stack_743.push(tok);
        continue;
      }
      if (Array.isArray(tok)) {
        Array.prototype.push.apply(stack_743, tok);
        continue;
      }
      if (_immutable.List.isList(tok)) {
        Array.prototype.push.apply(stack_743, tok.toArray());
        continue;
      }
      if (isEOS_635(tok)) {
        if (stack_743[0] && isLeftDelimiter_639(stack_743[0].token)) {
          throw this.createUnexpected(tok);
        }
        break;
      }
      if (isLeftDelimiter_639(tok)) {
        if (isLeftSyntax_637(tok)) {
          this.insideSyntaxTemplate.push(true);
        }
        let line = tok.slice.startLocation.line;
        let innerB = isLeftBrace_630(tok) ? isExprPrefix_670(line, b_744)(prefix_746) : true;
        let inner = this.read([new _syntax2.default(tok, this.context)], innerB, false);
        let stx = new _syntax2.default(inner, this.context);
        prefix_746 = prefix_746.concat(stx);
        stack_743.push(stx);
        if (singleDelimiter_745) {
          break;
        }
      } else if (isRightDelimiter_640(tok)) {
        if (stack_743[0] && !isMatchingDelimiters_641(stack_743[0].token, tok)) {
          throw this.createUnexpected(tok);
        }
        let stx = new _syntax2.default(tok, this.context);
        stack_743.push(stx);
        if (lastEl_681(this.insideSyntaxTemplate) && isRightSyntax_638(tok)) {
          this.insideSyntaxTemplate.pop();
        }
        break;
      } else {
        let stx = new _syntax2.default(tok, this.context);
        prefix_746 = prefix_746.concat(stx);
        stack_743.push(stx);
      }
    }
    return (0, _immutable.List)(stack_743);
  }
  advance(prefix_747, b_748) {
    let startLocation_749 = this.getLocation();
    this.lastIndex = this.index;
    this.lastLine = this.line;
    this.lastLineStart = this.lineStart;
    this.skipComment();
    this.startIndex = this.index;
    this.startLine = this.line;
    this.startLineStart = this.lineStart;
    if (this.replacementIndex && this.replacementIndex[0] && this.index >= this.replacementIndex[0].index) {
      let rep = this.replacementIndex[0].replacement;
      this.replacementIndex.shift();
      return rep;
    }
    let charCode_750 = this.source.charCodeAt(this.index);
    if (charCode_750 === 96) {
      let element,
          items = [];
      let startLocation_749 = this.getLocation();
      let start = this.index;
      this.index++;
      if (lastEl_681(this.insideSyntaxTemplate)) {
        let slice = this.getSlice(start, startLocation_749);
        return { type: RSYNTAX_626, value: "`", slice: slice };
      }
      do {
        element = this.scanTemplateElement();
        items.push(element);
        if (element.interp) {
          element = this.read([], false, true);
          (0, _errors.assert)(element.size === 1, "should only have read a single delimiter inside a template");
          items.push(element.get(0));
        }
      } while (!element.tail);
      return { type: _tokenizer.TokenType.TEMPLATE, items: (0, _immutable.List)(items) };
    } else if (charCode_750 === 35) {
      let startLocation_749 = this.getLocation();
      let start = this.index;
      let slice = this.getSlice(start, startLocation_749);
      this.index++;
      if (this.source.charCodeAt(this.index) === 96) {
        this.index++;
        return { type: LSYNTAX_625, value: "#`", slice: slice };
      }
      return { type: _tokenizer.TokenType.IDENTIFIER, value: "#", slice: slice };
    } else if (charCode_750 === 64) {
      let startLocation_749 = this.getLocation();
      let start = this.index;
      let slice = this.getSlice(start, startLocation_749);
      this.index++;
      return { type: AT_627, value: "@", slice: slice };
    }
    let lookahead_751 = super.advance();
    if (lookahead_751.type === _tokenizer.TokenType.DIV && isRegexPrefix_680(b_748)(prefix_747)) {
      return super.scanRegExp("/");
    }
    return lookahead_751;
  }
  scanTemplateElement() {
    let startLocation_752 = this.getLocation();
    let start_753 = this.index;
    while (this.index < this.source.length) {
      let ch = this.source.charCodeAt(this.index);
      switch (ch) {
        case 96:
          let slice = this.getSlice(start_753, startLocation_752);
          this.index++;
          return { type: _tokenizer.TokenType.TEMPLATE, tail: true, interp: false, slice: slice };
        case 36:
          if (this.source.charCodeAt(this.index + 1) === 123) {
            let slice = this.getSlice(start_753, startLocation_752);
            this.index += 1;
            return { type: _tokenizer.TokenType.TEMPLATE, tail: false, interp: true, slice: slice };
          }
          this.index++;
          break;
        case 92:
          {
            let octal = this.scanStringEscape("", null)[1];
            if (octal != null) {
              throw this.createILLEGAL();
            }
            break;
          }
        default:
          this.index++;
      }
    }
    throw this.createILLEGAL();
  }
}
exports.default = Reader;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3N3ZWV0L3NoaWZ0LXJlYWRlci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTs7OztBQUVBOztBQUNBOzs7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7QUFDQTs7SUFBYSxDOzs7Ozs7QUFDYixNQUFNLFdBQVcsb0JBQU0sSUFBdkI7QUFDQSxNQUFNLGNBQWMsb0JBQU0sT0FBMUI7QUFDQSxNQUFNLGNBQWMsRUFBQyxNQUFNLGFBQVAsRUFBcEI7QUFDQSxNQUFNLGNBQWMsRUFBQyxNQUFNLGNBQVAsRUFBcEI7QUFDQSxNQUFNLFNBQVMsRUFBQyxPQUFPLHNCQUFXLFVBQW5CLEVBQStCLE1BQU0sR0FBckMsRUFBZjtBQUNBLE1BQU0sc0JBQXNCLENBQUMsTUFBRCxFQUFTLE1BQVQsRUFBaUIsTUFBakIsRUFBeUIsT0FBekIsQ0FBNUI7QUFDQSxNQUFNLG9CQUFvQixFQUFFLE9BQUYsQ0FBVSxFQUFDLE1BQU0scUJBQVUsTUFBakIsRUFBVixDQUExQjtBQUNBLE1BQU0sa0JBQWtCLEVBQUUsT0FBRixDQUFVLEVBQUMsTUFBTSxxQkFBVSxNQUFqQixFQUFWLENBQXhCO0FBQ0EsTUFBTSxrQkFBa0IsRUFBRSxPQUFGLENBQVUsRUFBQyxNQUFNLHFCQUFVLE1BQWpCLEVBQVYsQ0FBeEI7QUFDQSxNQUFNLHFCQUFxQixFQUFFLE9BQUYsQ0FBVSxFQUFDLE1BQU0scUJBQVUsTUFBakIsRUFBVixDQUEzQjtBQUNBLE1BQU0sbUJBQW1CLEVBQUUsT0FBRixDQUFVLEVBQUMsTUFBTSxxQkFBVSxNQUFqQixFQUFWLENBQXpCO0FBQ0EsTUFBTSxtQkFBbUIsRUFBRSxPQUFGLENBQVUsRUFBQyxNQUFNLHFCQUFVLE1BQWpCLEVBQVYsQ0FBekI7QUFDQSxNQUFNLFlBQVksRUFBRSxPQUFGLENBQVUsRUFBQyxNQUFNLHFCQUFVLEdBQWpCLEVBQVYsQ0FBbEI7QUFDQSxNQUFNLGFBQWEsRUFBRSxPQUFGLENBQVUsRUFBQyxNQUFNLHFCQUFVLFVBQWpCLEVB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LEVBQUw7QUFDRTtBQUNFLGdCQUFJLFFBQVEsS0FBSyxnQkFBTCxDQUFzQixFQUF0QixFQUEwQixJQUExQixFQUFnQyxDQUFoQyxDQUFaO0FBQ0EsZ0JBQUksU0FBUyxJQUFiLEVBQW1CO0FBQ2pCLG9CQUFNLEtBQUssYUFBTCxFQUFOO0FBQ0Q7QUFDRDtBQUNEO0FBQ0g7QUFDRSxlQUFLLEtBQUw7QUF0Qko7QUF3QkQ7QUFDRCxVQUFNLEtBQUssYUFBTCxFQUFOO0FBQ0Q7QUE1SjJDO2tCQUF6QixNIiwiZmlsZSI6InNoaWZ0LXJlYWRlci5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBUb2tlbml6ZXIgZnJvbSBcInNoaWZ0LXBhcnNlci9kaXN0L3Rva2VuaXplclwiO1xuaW1wb3J0IHtUb2tlbkNsYXNzLCBUb2tlblR5cGV9IGZyb20gXCJzaGlmdC1wYXJzZXIvZGlzdC90b2tlbml6ZXJcIjtcbmltcG9ydCB7TGlzdH0gZnJvbSBcImltbXV0YWJsZVwiO1xuaW1wb3J0IFN5bnRheCBmcm9tIFwiLi9zeW50YXhcIjtcbmltcG9ydCB7TWF5YmV9IGZyb20gXCJyYW1kYS1mYW50YXN5XCI7XG5pbXBvcnQge2Fzc2VydH0gZnJvbSBcIi4vZXJyb3JzXCI7XG5pbXBvcnQgVGVybSBmcm9tIFwiLi90ZXJtc1wiO1xuaW1wb3J0ICAqIGFzIFIgZnJvbSBcInJhbWRhXCI7XG5jb25zdCBKdXN0XzYyMyA9IE1heWJlLkp1c3Q7XG5jb25zdCBOb3RoaW5nXzYyNCA9IE1heWJlLk5vdGhpbmc7XG5jb25zdCBMU1lOVEFYXzYyNSA9IHtuYW1lOiBcImxlZnQtc3ludGF4XCJ9O1xuY29uc3QgUlNZTlRBWF82MjYgPSB7bmFtZTogXCJyaWdodC1zeW50YXhcIn07XG5jb25zdCBBVF82MjcgPSB7a2xhc3M6IFRva2VuQ2xhc3MuUHVuY3R1YXRvciwgbmFtZTogXCJAXCJ9O1xuY29uc3QgbGl0ZXJhbEtleXdvcmRzXzYyOCA9IFtcInRoaXNcIiwgXCJudWxsXCIsIFwidHJ1ZVwiLCBcImZhbHNlXCJdO1xuY29uc3QgaXNMZWZ0QnJhY2tldF82MjkgPSBSLndoZXJlRXEoe3R5cGU6IFRva2VuVHlwZS5MQlJBQ0t9KTtcbmNvbnN0IGlzTGVmdEJyYWNlXzYzMCA9IFIud2hlcmVFcSh7dHlwZTogVG9rZW5UeXBlLkxCUkFDRX0pO1xuY29uc3QgaXNMZWZ0UGFyZW5fNjMxID0gUi53aGVyZUVxKHt0eXBlOiBUb2tlblR5cGUuTFBBUkVOfSk7XG5jb25zdCBpc1JpZ2h0QnJhY2tldF82MzIgPSBSLndoZXJlRXEoe3R5cGU6IFRva2VuVHlwZS5SQlJBQ0t9KTtcbmNvbnN0IGlzUmlnaHRCcmFjZV82MzMgPSBSLndoZXJlRXEoe3R5cGU6IFRva2VuVHlwZS5SQlJBQ0V9KTtcbmNvbnN0IGlzUmlnaHRQYXJlbl82MzQgPSBSLndoZXJlRXEoe3R5cGU6IFRva2VuVHlwZS5SUEFSRU59KTtcbmNvbnN0IGlzRU9TXzYzNSA9IFIud2hlcmVFcSh7dHlwZTogVG9rZW5UeXBlLkVPU30pO1xuY29uc3QgaXNIYXNoXzYzNiA9IFIud2hlcmVFcSh7dHlwZTogVG9rZW5UeXBlLklERU5USUZJRVIsIHZhbHVlOiBcIiNcIn0pO1xuY29uc3QgaXNMZWZ0U3ludGF4XzYzNyA9IFIud2hlcmVFcSh7dHlwZTogTFNZTlRBWF82MjV9KTtcbmNvbnN0IGlzUmlnaHRTeW50YXhfNjM4ID0gUi53aGVyZUVxKHt0eXBlOiBSU1lOVEFYXzYyNn0pO1xuY29uc3QgaXNMZWZ0RGVsaW1pdGVyXzYzOSA9IFIuYW55UGFzcyhbaXNMZWZ0QnJhY2tldF82MjksIGlzTGVmdEJyYWNlXzYzMCwgaXNMZWZ0UGFyZW5fNjMxLCBpc0xlZnRTeW50YXhfNjM3XSk7XG5jb25zdCBpc1JpZ2h0RGVsaW1pdGVyXzY0MCA9IFIuYW55UGFzcyhbaXNSaWdodEJyYWNrZXRfNjMyLCBpc1JpZ2h0QnJhY2VfNjMzLCBpc1JpZ2h0UGFyZW5fNjM0LCBpc1JpZ2h0U3ludGF4XzYzOF0pO1xuY29uc3QgaXNNYXRjaGluZ0RlbGltaXRlcnNfNjQxID0gUi5jb25kKFtbaXNMZWZ0QnJhY2tldF82MjksIChfXzY4MiwgYl82ODMpID0+IGlzUmlnaHRCcmFja2V0XzYzMihiXzY4MyldLCBbaXNMZWZ0QnJhY2VfNjMwLCAoX182ODQsIGJfNjg1KSA9PiBpc1JpZ2h0QnJhY2VfNjMzKGJfNjg1KV0sIFtpc0xlZnRQYXJlbl82MzEsIChfXzY4NiwgYl82ODcpID0+IGlzUmlnaHRQYXJlbl82MzQoYl82ODcpXSwgW2lzTGVmdFN5bnRheF82MzcsIChfXzY4OCwgYl82ODkpID0+IGlzUmlnaHRTeW50YXhfNjM4KGJfNjg5KV0sIFtSLlQsIFIuRl1dKTtcbmNvbnN0IGFzc2lnbk9wc182NDIgPSBbXCI9XCIsIFwiKz1cIiwgXCItPVwiLCBcIio9XCIsIFwiLz1cIiwgXCIlPVwiLCBcIjw8PVwiLCBcIj4+PVwiLCBcIj4+Pj1cIiwgXCImPVwiLCBcInw9XCIsIFwiXj1cIiwgXCIsXCJdO1xuY29uc3QgYmluYXJ5T3BzXzY0MyA9IFtcIitcIiwgXCItXCIsIFwiKlwiLCBcIi9cIiwgXCIlXCIsIFwiPDxcIiwgXCI+PlwiLCBcIj4+PlwiLCBcIiZcIiwgXCJ8XCIsIFwiXlwiLCBcIiYmXCIsIFwifHxcIiwgXCI/XCIsIFwiOlwiLCBcIj09PVwiLCBcIj09XCIsIFwiPj1cIiwgXCI8PVwiLCBcIjxcIiwgXCI+XCIsIFwiIT1cIiwgXCIhPT1cIiwgXCJpbnN0YW5jZW9mXCJdO1xuY29uc3QgdW5hcnlPcHNfNjQ0ID0gW1wiKytcIiwgXCItLVwiLCBcIn5cIiwgXCIhXCIsIFwiZGVsZXRlXCIsIFwidm9pZFwiLCBcInR5cGVvZlwiLCBcInlpZWxkXCIsIFwidGhyb3dcIiwgXCJuZXdcIl07XG5jb25zdCBpc0VtcHR5XzY0NSA9IFIud2hlcmVFcSh7c2l6ZTogMH0pO1xuY29uc3QgaXNQdW5jdHVhdG9yXzY0NiA9IHNfNjkwID0+IHNfNjkwLm1hdGNoKFwicHVuY3R1YXRvclwiKTtcbmNvbnN0IGlzS2V5d29yZF82NDcgPSBzXzY5MSA9PiBzXzY5MS5tYXRjaChcImtleXdvcmRcIik7XG5jb25zdCBpc0RlbGltaXRlcl82NDggPSBzXzY5MiA9PiBzXzY5Mi5tYXRjaChcImRlbGltaXRlclwiKTtcbmNvbnN0IGlzUGFyZW5zXzY0OSA9IHNfNjkzID0+IHNfNjkzLm1hdGNoKFwicGFyZW5zXCIpO1xuY29uc3QgaXNCcmFjZXNfNjUwID0gc182OTQgPT4gc182OTQubWF0Y2goXCJicmFjZXNcIik7XG5jb25zdCBpc0JyYWNrZXRzXzY1MSA9IHNfNjk1ID0+IHNfNjk1Lm1hdGNoKFwiYnJhY2tldHNcIik7XG5jb25zdCBpc0lkZW50aWZpZXJfNjUyID0gc182OTYgPT4gc182OTYubWF0Y2goXCJpZGVudGlmaWVyXCIpO1xuY29uc3QgdmFsXzY1MyA9IHNfNjk3ID0+IHNfNjk3LnZhbCgpO1xuY29uc3QgaXNWYWxfNjU0ID0gUi5jdXJyeSgodl82OTgsIHNfNjk5KSA9PiBzXzY5OS52YWwoKSA9PT0gdl82OTgpO1xuY29uc3QgaXNEb3RfNjU1ID0gUi5hbGxQYXNzKFtpc1B1bmN0dWF0b3JfNjQ2LCBpc1ZhbF82NTQoXCIuXCIpXSk7XG5jb25zdCBpc0NvbG9uXzY1NiA9IFIuYWxsUGFzcyhbaXNQdW5jdHVhdG9yXzY0NiwgaXNWYWxfNjU0KFwiOlwiKV0pO1xuY29uc3QgaXNGdW5jdGlvbktleXdvcmRfNjU3ID0gUi5hbGxQYXNzKFtpc0tleXdvcmRfNjQ3LCBpc1ZhbF82NTQoXCJmdW5jdGlvblwiKV0pO1xuY29uc3QgaXNPcGVyYXRvcl82NTggPSBzXzcwMCA9PiAoc183MDAubWF0Y2goXCJwdW5jdHVhdG9yXCIpIHx8IHNfNzAwLm1hdGNoKFwia2V5d29yZFwiKSkgJiYgUi5hbnkoUi5lcXVhbHMoc183MDAudmFsKCkpLCBhc3NpZ25PcHNfNjQyLmNvbmNhdChiaW5hcnlPcHNfNjQzKS5jb25jYXQodW5hcnlPcHNfNjQ0KSk7XG5jb25zdCBpc05vbkxpdGVyYWxLZXl3b3JkXzY1OSA9IFIuYWxsUGFzcyhbaXNLZXl3b3JkXzY0Nywgc183MDEgPT4gUi5ub25lKFIuZXF1YWxzKHNfNzAxLnZhbCgpKSwgbGl0ZXJhbEtleXdvcmRzXzYyOCldKTtcbmNvbnN0IGlzS2V5d29yZEV4cHJQcmVmaXhfNjYwID0gUi5hbGxQYXNzKFtpc0tleXdvcmRfNjQ3LCBzXzcwMiA9PiBSLmFueShSLmVxdWFscyhzXzcwMi52YWwoKSksIFtcImluc3RhbmNlb2ZcIiwgXCJ0eXBlb2ZcIiwgXCJkZWxldGVcIiwgXCJ2b2lkXCIsIFwieWllbGRcIiwgXCJ0aHJvd1wiLCBcIm5ld1wiLCBcImNhc2VcIl0pXSk7XG5sZXQgbGFzdF82NjEgPSBwXzcwMyA9PiBwXzcwMy5sYXN0KCk7XG5sZXQgc2FmZUxhc3RfNjYyID0gUi5waXBlKFIuY29uZChbW2lzRW1wdHlfNjQ1LCBSLmFsd2F5cyhOb3RoaW5nXzYyNCgpKV0sIFtSLlQsIFIuY29tcG9zZShNYXliZS5vZiwgbGFzdF82NjEpXV0pKTtcbmxldCBzdHVmZlRydWVfNjYzID0gUi5jdXJyeSgocF83MDQsIGJfNzA1KSA9PiBiXzcwNSA/IEp1c3RfNjIzKHBfNzA0KSA6IE5vdGhpbmdfNjI0KCkpO1xubGV0IHN0dWZmRmFsc2VfNjY0ID0gUi5jdXJyeSgocF83MDYsIGJfNzA3KSA9PiAhYl83MDcgPyBKdXN0XzYyMyhwXzcwNikgOiBOb3RoaW5nXzYyNCgpKTtcbmxldCBpc1RvcENvbG9uXzY2NSA9IFIucGlwZShzYWZlTGFzdF82NjIsIFIubWFwKGlzQ29sb25fNjU2KSwgTWF5YmUubWF5YmUoZmFsc2UsIFIuaWRlbnRpdHkpKTtcbmxldCBpc1RvcFB1bmN0dWF0b3JfNjY2ID0gUi5waXBlKHNhZmVMYXN0XzY2MiwgUi5tYXAoaXNQdW5jdHVhdG9yXzY0NiksIE1heWJlLm1heWJlKGZhbHNlLCBSLmlkZW50aXR5KSk7XG5sZXQgaXNFeHByUmV0dXJuXzY2NyA9IFIuY3VycnkoKGxfNzA4LCBwXzcwOSkgPT4ge1xuICBsZXQgcmV0S3dkXzcxMCA9IHNhZmVMYXN0XzY2MihwXzcwOSk7XG4gIGxldCBtYXliZURvdF83MTEgPSBwb3BfNjc4KHBfNzA5KS5jaGFpbihzYWZlTGFzdF82NjIpO1xuICBpZiAobWF5YmVEb3RfNzExLm1hcChpc0RvdF82NTUpLmdldE9yRWxzZShmYWxzZSkpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICByZXR1cm4gcmV0S3dkXzcxMC5tYXAoc183MTIgPT4ge1xuICAgIHJldHVybiBzXzcxMi5tYXRjaChcImtleXdvcmRcIikgJiYgc183MTIudmFsKCkgPT09IFwicmV0dXJuXCIgJiYgc183MTIubGluZU51bWJlcigpID09PSBsXzcwODtcbiAgfSkuZ2V0T3JFbHNlKGZhbHNlKTtcbn0pO1xuY29uc3QgaXNUb3BPcGVyYXRvcl82NjggPSBSLnBpcGUoc2FmZUxhc3RfNjYyLCBSLm1hcChpc09wZXJhdG9yXzY1OCksIE1heWJlLm1heWJlKGZhbHNlLCBSLmlkZW50aXR5KSk7XG5jb25zdCBpc1RvcEtleXdvcmRFeHByUHJlZml4XzY2OSA9IFIucGlwZShzYWZlTGFzdF82NjIsIFIubWFwKGlzS2V5d29yZEV4cHJQcmVmaXhfNjYwKSwgTWF5YmUubWF5YmUoZmFsc2UsIFIuaWRlbnRpdHkpKTtcbmxldCBpc0V4cHJQcmVmaXhfNjcwID0gUi5jdXJyeSgobF83MTMsIGJfNzE0KSA9PiBSLmNvbmQoW1tpc0VtcHR5XzY0NSwgUi5hbHdheXMoYl83MTQpXSwgW2lzVG9wQ29sb25fNjY1LCBSLmFsd2F5cyhiXzcxNCldLCBbaXNUb3BLZXl3b3JkRXhwclByZWZpeF82NjksIFIuVF0sIFtpc1RvcE9wZXJhdG9yXzY2OCwgUi5UXSwgW2lzVG9wUHVuY3R1YXRvcl82NjYsIFIuYWx3YXlzKGJfNzE0KV0sIFtpc0V4cHJSZXR1cm5fNjY3KGxfNzEzKSwgUi5UXSwgW1IuVCwgUi5GXV0pKTtcbmxldCBjdXJseV82NzEgPSBwXzcxNSA9PiBzYWZlTGFzdF82NjIocF83MTUpLm1hcChpc0JyYWNlc182NTApLmNoYWluKHN0dWZmVHJ1ZV82NjMocF83MTUpKTtcbmxldCBwYXJlbl82NzIgPSBwXzcxNiA9PiBzYWZlTGFzdF82NjIocF83MTYpLm1hcChpc1BhcmVuc182NDkpLmNoYWluKHN0dWZmVHJ1ZV82NjMocF83MTYpKTtcbmxldCBmdW5jXzY3MyA9IHBfNzE3ID0+IHNhZmVMYXN0XzY2MihwXzcxNykubWFwKGlzRnVuY3Rpb25LZXl3b3JkXzY1NykuY2hhaW4oc3R1ZmZUcnVlXzY2MyhwXzcxNykpO1xubGV0IGlkZW50XzY3NCA9IHBfNzE4ID0+IHNhZmVMYXN0XzY2MihwXzcxOCkubWFwKGlzSWRlbnRpZmllcl82NTIpLmNoYWluKHN0dWZmVHJ1ZV82NjMocF83MTgpKTtcbmxldCBub25MaXRlcmFsS2V5d29yZF82NzUgPSBwXzcxOSA9PiBzYWZlTGFzdF82NjIocF83MTkpLm1hcChpc05vbkxpdGVyYWxLZXl3b3JkXzY1OSkuY2hhaW4oc3R1ZmZUcnVlXzY2MyhwXzcxOSkpO1xubGV0IG9wdF82NzYgPSBSLmN1cnJ5KChhXzcyMCwgYl83MjEsIHBfNzIyKSA9PiB7XG4gIGxldCByZXN1bHRfNzIzID0gUi5waXBlSyhhXzcyMCwgYl83MjEpKE1heWJlLm9mKHBfNzIyKSk7XG4gIHJldHVybiBNYXliZS5pc0p1c3QocmVzdWx0XzcyMykgPyByZXN1bHRfNzIzIDogTWF5YmUub2YocF83MjIpO1xufSk7XG5sZXQgbm90RG90XzY3NyA9IFIuaWZFbHNlKFIud2hlcmVFcSh7c2l6ZTogMH0pLCBKdXN0XzYyMywgcF83MjQgPT4gc2FmZUxhc3RfNjYyKHBfNzI0KS5tYXAoc183MjUgPT4gIShzXzcyNS5tYXRjaChcInB1bmN0dWF0b3JcIikgJiYgc183MjUudmFsKCkgPT09IFwiLlwiKSkuY2hhaW4oc3R1ZmZUcnVlXzY2MyhwXzcyNCkpKTtcbmxldCBwb3BfNjc4ID0gUi5jb21wb3NlKEp1c3RfNjIzLCBwXzcyNiA9PiBwXzcyNi5wb3AoKSk7XG5jb25zdCBmdW5jdGlvblByZWZpeF82NzkgPSBSLnBpcGVLKGN1cmx5XzY3MSwgcG9wXzY3OCwgcGFyZW5fNjcyLCBwb3BfNjc4LCBvcHRfNjc2KGlkZW50XzY3NCwgcG9wXzY3OCksIGZ1bmNfNjczKTtcbmNvbnN0IGlzUmVnZXhQcmVmaXhfNjgwID0gYl83MjcgPT4gUi5hbnlQYXNzKFtpc0VtcHR5XzY0NSwgaXNUb3BQdW5jdHVhdG9yXzY2NiwgUi5waXBlKE1heWJlLm9mLCBSLnBpcGVLKG5vbkxpdGVyYWxLZXl3b3JkXzY3NSwgcG9wXzY3OCwgbm90RG90XzY3NyksIE1heWJlLmlzSnVzdCksIFIucGlwZShNYXliZS5vZiwgUi5waXBlSyhwYXJlbl82NzIsIHBvcF82NzgsIG5vbkxpdGVyYWxLZXl3b3JkXzY3NSwgcG9wXzY3OCwgbm90RG90XzY3NyksIE1heWJlLmlzSnVzdCksIFIucGlwZShNYXliZS5vZiwgZnVuY3Rpb25QcmVmaXhfNjc5LCBSLmNoYWluKHBfNzI4ID0+IHtcbiAgcmV0dXJuIHNhZmVMYXN0XzY2MihwXzcyOCkubWFwKHNfNzI5ID0+IHNfNzI5LmxpbmVOdW1iZXIoKSkuY2hhaW4oZm5MaW5lXzczMCA9PiB7XG4gICAgcmV0dXJuIHBvcF82NzgocF83MjgpLm1hcChpc0V4cHJQcmVmaXhfNjcwKGZuTGluZV83MzAsIGJfNzI3KSk7XG4gIH0pLmNoYWluKHN0dWZmRmFsc2VfNjY0KHBfNzI4KSk7XG59KSwgTWF5YmUuaXNKdXN0KSwgcF83MzEgPT4ge1xuICBsZXQgaXNDdXJseV83MzIgPSBNYXliZS5pc0p1c3Qoc2FmZUxhc3RfNjYyKHBfNzMxKS5tYXAoaXNCcmFjZXNfNjUwKSk7XG4gIGxldCBhbHJlYWR5Q2hlY2tlZEZ1bmN0aW9uXzczMyA9IFIucGlwZShNYXliZS5vZiwgZnVuY3Rpb25QcmVmaXhfNjc5LCBNYXliZS5pc0p1c3QpKHBfNzMxKTtcbiAgaWYgKGFscmVhZHlDaGVja2VkRnVuY3Rpb25fNzMzKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIHJldHVybiBSLnBpcGUoTWF5YmUub2YsIFIuY2hhaW4oY3VybHlfNjcxKSwgUi5jaGFpbihwXzczNCA9PiB7XG4gICAgcmV0dXJuIHNhZmVMYXN0XzY2MihwXzczNCkubWFwKHNfNzM1ID0+IHNfNzM1LmxpbmVOdW1iZXIoKSkuY2hhaW4oY3VybHlMaW5lXzczNiA9PiB7XG4gICAgICByZXR1cm4gcG9wXzY3OChwXzczNCkubWFwKGlzRXhwclByZWZpeF82NzAoY3VybHlMaW5lXzczNiwgYl83MjcpKTtcbiAgICB9KS5jaGFpbihzdHVmZkZhbHNlXzY2NChwXzczNCkpO1xuICB9KSwgTWF5YmUuaXNKdXN0KShwXzczMSk7XG59XSk7XG5mdW5jdGlvbiBsYXN0RWxfNjgxKGxfNzM3KSB7XG4gIHJldHVybiBsXzczN1tsXzczNy5sZW5ndGggLSAxXTtcbn1cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFJlYWRlciBleHRlbmRzIFRva2VuaXplciB7XG4gIGNvbnN0cnVjdG9yKHN0cmluZ3NfNzM4LCBjb250ZXh0XzczOSwgcmVwbGFjZW1lbnRzXzc0MCkge1xuICAgIHN1cGVyKEFycmF5LmlzQXJyYXkoc3RyaW5nc183MzgpID8gc3RyaW5nc183Mzguam9pbihcIlwiKSA6IHN0cmluZ3NfNzM4KTtcbiAgICB0aGlzLmRlbGltU3RhY2sgPSBuZXcgTWFwO1xuICAgIHRoaXMuaW5zaWRlU3ludGF4VGVtcGxhdGUgPSBbZmFsc2VdO1xuICAgIHRoaXMuY29udGV4dCA9IGNvbnRleHRfNzM5O1xuICAgIGlmIChBcnJheS5pc0FycmF5KHN0cmluZ3NfNzM4KSkge1xuICAgICAgbGV0IHRvdGFsSW5kZXggPSAwO1xuICAgICAgdGhpcy5yZXBsYWNlbWVudEluZGV4ID0gUi5yZWR1Y2UoKGFjY183NDEsIHN0clJlcF83NDIpID0+IHtcbiAgICAgICAgYWNjXzc0MS5wdXNoKHtpbmRleDogdG90YWxJbmRleCArIHN0clJlcF83NDJbMF0ubGVuZ3RoLCByZXBsYWNlbWVudDogc3RyUmVwXzc0MlsxXX0pO1xuICAgICAgICB0b3RhbEluZGV4ICs9IHN0clJlcF83NDJbMF0ubGVuZ3RoO1xuICAgICAgICByZXR1cm4gYWNjXzc0MTtcbiAgICAgIH0sIFtdLCBSLnppcChzdHJpbmdzXzczOCwgcmVwbGFjZW1lbnRzXzc0MCkpO1xuICAgIH1cbiAgfVxuICByZWFkKHN0YWNrXzc0MyA9IFtdLCBiXzc0NCA9IGZhbHNlLCBzaW5nbGVEZWxpbWl0ZXJfNzQ1ID0gZmFsc2UpIHtcbiAgICBsZXQgcHJlZml4Xzc0NiA9IExpc3QoKTtcbiAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgbGV0IHRvayA9IHRoaXMuYWR2YW5jZShwcmVmaXhfNzQ2LCBiXzc0NCk7XG4gICAgICBpZiAodG9rIGluc3RhbmNlb2YgU3ludGF4IHx8IHRvayBpbnN0YW5jZW9mIFRlcm0pIHtcbiAgICAgICAgc3RhY2tfNzQzLnB1c2godG9rKTtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheSh0b2spKSB7XG4gICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KHN0YWNrXzc0MywgdG9rKTtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBpZiAoTGlzdC5pc0xpc3QodG9rKSkge1xuICAgICAgICBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShzdGFja183NDMsIHRvay50b0FycmF5KCkpO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIGlmIChpc0VPU182MzUodG9rKSkge1xuICAgICAgICBpZiAoc3RhY2tfNzQzWzBdICYmIGlzTGVmdERlbGltaXRlcl82Mzkoc3RhY2tfNzQzWzBdLnRva2VuKSkge1xuICAgICAgICAgIHRocm93IHRoaXMuY3JlYXRlVW5leHBlY3RlZCh0b2spO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgaWYgKGlzTGVmdERlbGltaXRlcl82MzkodG9rKSkge1xuICAgICAgICBpZiAoaXNMZWZ0U3ludGF4XzYzNyh0b2spKSB7XG4gICAgICAgICAgdGhpcy5pbnNpZGVTeW50YXhUZW1wbGF0ZS5wdXNoKHRydWUpO1xuICAgICAgICB9XG4gICAgICAgIGxldCBsaW5lID0gdG9rLnNsaWNlLnN0YXJ0TG9jYXRpb24ubGluZTtcbiAgICAgICAgbGV0IGlubmVyQiA9IGlzTGVmdEJyYWNlXzYzMCh0b2spID8gaXNFeHByUHJlZml4XzY3MChsaW5lLCBiXzc0NCkocHJlZml4Xzc0NikgOiB0cnVlO1xuICAgICAgICBsZXQgaW5uZXIgPSB0aGlzLnJlYWQoW25ldyBTeW50YXgodG9rLCB0aGlzLmNvbnRleHQpXSwgaW5uZXJCLCBmYWxzZSk7XG4gICAgICAgIGxldCBzdHggPSBuZXcgU3ludGF4KGlubmVyLCB0aGlzLmNvbnRleHQpO1xuICAgICAgICBwcmVmaXhfNzQ2ID0gcHJlZml4Xzc0Ni5jb25jYXQoc3R4KTtcbiAgICAgICAgc3RhY2tfNzQzLnB1c2goc3R4KTtcbiAgICAgICAgaWYgKHNpbmdsZURlbGltaXRlcl83NDUpIHtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChpc1JpZ2h0RGVsaW1pdGVyXzY0MCh0b2spKSB7XG4gICAgICAgIGlmIChzdGFja183NDNbMF0gJiYgIWlzTWF0Y2hpbmdEZWxpbWl0ZXJzXzY0MShzdGFja183NDNbMF0udG9rZW4sIHRvaykpIHtcbiAgICAgICAgICB0aHJvdyB0aGlzLmNyZWF0ZVVuZXhwZWN0ZWQodG9rKTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgc3R4ID0gbmV3IFN5bnRheCh0b2ssIHRoaXMuY29udGV4dCk7XG4gICAgICAgIHN0YWNrXzc0My5wdXNoKHN0eCk7XG4gICAgICAgIGlmIChsYXN0RWxfNjgxKHRoaXMuaW5zaWRlU3ludGF4VGVtcGxhdGUpICYmIGlzUmlnaHRTeW50YXhfNjM4KHRvaykpIHtcbiAgICAgICAgICB0aGlzLmluc2lkZVN5bnRheFRlbXBsYXRlLnBvcCgpO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbGV0IHN0eCA9IG5ldyBTeW50YXgodG9rLCB0aGlzLmNvbnRleHQpO1xuICAgICAgICBwcmVmaXhfNzQ2ID0gcHJlZml4Xzc0Ni5jb25jYXQoc3R4KTtcbiAgICAgICAgc3RhY2tfNzQzLnB1c2goc3R4KTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIExpc3Qoc3RhY2tfNzQzKTtcbiAgfVxuICBhZHZhbmNlKHByZWZpeF83NDcsIGJfNzQ4KSB7XG4gICAgbGV0IHN0YXJ0TG9jYXRpb25fNzQ5ID0gdGhpcy5nZXRMb2NhdGlvbigpO1xuICAgIHRoaXMubGFzdEluZGV4ID0gdGhpcy5pbmRleDtcbiAgICB0aGlzLmxhc3RMaW5lID0gdGhpcy5saW5lO1xuICAgIHRoaXMubGFzdExpbmVTdGFydCA9IHRoaXMubGluZVN0YXJ0O1xuICAgIHRoaXMuc2tpcENvbW1lbnQoKTtcbiAgICB0aGlzLnN0YXJ0SW5kZXggPSB0aGlzLmluZGV4O1xuICAgIHRoaXMuc3RhcnRMaW5lID0gdGhpcy5saW5lO1xuICAgIHRoaXMuc3RhcnRMaW5lU3RhcnQgPSB0aGlzLmxpbmVTdGFydDtcbiAgICBpZiAodGhpcy5yZXBsYWNlbWVudEluZGV4ICYmIHRoaXMucmVwbGFjZW1lbnRJbmRleFswXSAmJiB0aGlzLmluZGV4ID49IHRoaXMucmVwbGFjZW1lbnRJbmRleFswXS5pbmRleCkge1xuICAgICAgbGV0IHJlcCA9IHRoaXMucmVwbGFjZW1lbnRJbmRleFswXS5yZXBsYWNlbWVudDtcbiAgICAgIHRoaXMucmVwbGFjZW1lbnRJbmRleC5zaGlmdCgpO1xuICAgICAgcmV0dXJuIHJlcDtcbiAgICB9XG4gICAgbGV0IGNoYXJDb2RlXzc1MCA9IHRoaXMuc291cmNlLmNoYXJDb2RlQXQodGhpcy5pbmRleCk7XG4gICAgaWYgKGNoYXJDb2RlXzc1MCA9PT0gOTYpIHtcbiAgICAgIGxldCBlbGVtZW50LCBpdGVtcyA9IFtdO1xuICAgICAgbGV0IHN0YXJ0TG9jYXRpb25fNzQ5ID0gdGhpcy5nZXRMb2NhdGlvbigpO1xuICAgICAgbGV0IHN0YXJ0ID0gdGhpcy5pbmRleDtcbiAgICAgIHRoaXMuaW5kZXgrKztcbiAgICAgIGlmIChsYXN0RWxfNjgxKHRoaXMuaW5zaWRlU3ludGF4VGVtcGxhdGUpKSB7XG4gICAgICAgIGxldCBzbGljZSA9IHRoaXMuZ2V0U2xpY2Uoc3RhcnQsIHN0YXJ0TG9jYXRpb25fNzQ5KTtcbiAgICAgICAgcmV0dXJuIHt0eXBlOiBSU1lOVEFYXzYyNiwgdmFsdWU6IFwiYFwiLCBzbGljZTogc2xpY2V9O1xuICAgICAgfVxuICAgICAgZG8ge1xuICAgICAgICBlbGVtZW50ID0gdGhpcy5zY2FuVGVtcGxhdGVFbGVtZW50KCk7XG4gICAgICAgIGl0ZW1zLnB1c2goZWxlbWVudCk7XG4gICAgICAgIGlmIChlbGVtZW50LmludGVycCkge1xuICAgICAgICAgIGVsZW1lbnQgPSB0aGlzLnJlYWQoW10sIGZhbHNlLCB0cnVlKTtcbiAgICAgICAgICBhc3NlcnQoZWxlbWVudC5zaXplID09PSAxLCBcInNob3VsZCBvbmx5IGhhdmUgcmVhZCBhIHNpbmdsZSBkZWxpbWl0ZXIgaW5zaWRlIGEgdGVtcGxhdGVcIik7XG4gICAgICAgICAgaXRlbXMucHVzaChlbGVtZW50LmdldCgwKSk7XG4gICAgICAgIH1cbiAgICAgIH0gd2hpbGUgKCFlbGVtZW50LnRhaWwpO1xuICAgICAgcmV0dXJuIHt0eXBlOiBUb2tlblR5cGUuVEVNUExBVEUsIGl0ZW1zOiBMaXN0KGl0ZW1zKX07XG4gICAgfSBlbHNlIGlmIChjaGFyQ29kZV83NTAgPT09IDM1KSB7XG4gICAgICBsZXQgc3RhcnRMb2NhdGlvbl83NDkgPSB0aGlzLmdldExvY2F0aW9uKCk7XG4gICAgICBsZXQgc3RhcnQgPSB0aGlzLmluZGV4O1xuICAgICAgbGV0IHNsaWNlID0gdGhpcy5nZXRTbGljZShzdGFydCwgc3RhcnRMb2NhdGlvbl83NDkpO1xuICAgICAgdGhpcy5pbmRleCsrO1xuICAgICAgaWYgKHRoaXMuc291cmNlLmNoYXJDb2RlQXQodGhpcy5pbmRleCkgPT09IDk2KSB7XG4gICAgICAgIHRoaXMuaW5kZXgrKztcbiAgICAgICAgcmV0dXJuIHt0eXBlOiBMU1lOVEFYXzYyNSwgdmFsdWU6IFwiI2BcIiwgc2xpY2U6IHNsaWNlfTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7dHlwZTogVG9rZW5UeXBlLklERU5USUZJRVIsIHZhbHVlOiBcIiNcIiwgc2xpY2U6IHNsaWNlfTtcbiAgICB9IGVsc2UgaWYgKGNoYXJDb2RlXzc1MCA9PT0gNjQpIHtcbiAgICAgIGxldCBzdGFydExvY2F0aW9uXzc0OSA9IHRoaXMuZ2V0TG9jYXRpb24oKTtcbiAgICAgIGxldCBzdGFydCA9IHRoaXMuaW5kZXg7XG4gICAgICBsZXQgc2xpY2UgPSB0aGlzLmdldFNsaWNlKHN0YXJ0LCBzdGFydExvY2F0aW9uXzc0OSk7XG4gICAgICB0aGlzLmluZGV4Kys7XG4gICAgICByZXR1cm4ge3R5cGU6IEFUXzYyNywgdmFsdWU6IFwiQFwiLCBzbGljZTogc2xpY2V9O1xuICAgIH1cbiAgICBsZXQgbG9va2FoZWFkXzc1MSA9IHN1cGVyLmFkdmFuY2UoKTtcbiAgICBpZiAobG9va2FoZWFkXzc1MS50eXBlID09PSBUb2tlblR5cGUuRElWICYmIGlzUmVnZXhQcmVmaXhfNjgwKGJfNzQ4KShwcmVmaXhfNzQ3KSkge1xuICAgICAgcmV0dXJuIHN1cGVyLnNjYW5SZWdFeHAoXCIvXCIpO1xuICAgIH1cbiAgICByZXR1cm4gbG9va2FoZWFkXzc1MTtcbiAgfVxuICBzY2FuVGVtcGxhdGVFbGVtZW50KCkge1xuICAgIGxldCBzdGFydExvY2F0aW9uXzc1MiA9IHRoaXMuZ2V0TG9jYXRpb24oKTtcbiAgICBsZXQgc3RhcnRfNzUzID0gdGhpcy5pbmRleDtcbiAgICB3aGlsZSAodGhpcy5pbmRleCA8IHRoaXMuc291cmNlLmxlbmd0aCkge1xuICAgICAgbGV0IGNoID0gdGhpcy5zb3VyY2UuY2hhckNvZGVBdCh0aGlzLmluZGV4KTtcbiAgICAgIHN3aXRjaCAoY2gpIHtcbiAgICAgICAgY2FzZSA5NjpcbiAgICAgICAgICBsZXQgc2xpY2UgPSB0aGlzLmdldFNsaWNlKHN0YXJ0Xzc1Mywgc3RhcnRMb2NhdGlvbl83NTIpO1xuICAgICAgICAgIHRoaXMuaW5kZXgrKztcbiAgICAgICAgICByZXR1cm4ge3R5cGU6IFRva2VuVHlwZS5URU1QTEFURSwgdGFpbDogdHJ1ZSwgaW50ZXJwOiBmYWxzZSwgc2xpY2U6IHNsaWNlfTtcbiAgICAgICAgY2FzZSAzNjpcbiAgICAgICAgICBpZiAodGhpcy5zb3VyY2UuY2hhckNvZGVBdCh0aGlzLmluZGV4ICsgMSkgPT09IDEyMykge1xuICAgICAgICAgICAgbGV0IHNsaWNlID0gdGhpcy5nZXRTbGljZShzdGFydF83NTMsIHN0YXJ0TG9jYXRpb25fNzUyKTtcbiAgICAgICAgICAgIHRoaXMuaW5kZXggKz0gMTtcbiAgICAgICAgICAgIHJldHVybiB7dHlwZTogVG9rZW5UeXBlLlRFTVBMQVRFLCB0YWlsOiBmYWxzZSwgaW50ZXJwOiB0cnVlLCBzbGljZTogc2xpY2V9O1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLmluZGV4Kys7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgOTI6XG4gICAgICAgICAge1xuICAgICAgICAgICAgbGV0IG9jdGFsID0gdGhpcy5zY2FuU3RyaW5nRXNjYXBlKFwiXCIsIG51bGwpWzFdO1xuICAgICAgICAgICAgaWYgKG9jdGFsICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgdGhyb3cgdGhpcy5jcmVhdGVJTExFR0FMKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgdGhpcy5pbmRleCsrO1xuICAgICAgfVxuICAgIH1cbiAgICB0aHJvdyB0aGlzLmNyZWF0ZUlMTEVHQUwoKTtcbiAgfVxufVxuIl19