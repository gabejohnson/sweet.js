"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.serializer = exports.makeDeserializer = undefined;

var _transitJs = require("transit-js");

var _transitJs2 = _interopRequireDefault(_transitJs);

var _immutable = require("immutable");

var _syntax = require("./syntax");

var _syntax2 = _interopRequireDefault(_syntax);

var _symbol = require("./symbol");

var _tokenizer = require("shift-parser/dist/tokenizer");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var typeMap_494 = [_tokenizer.TokenType.STRING, _tokenizer.TokenType.EOS, _tokenizer.TokenType.LPAREN, _tokenizer.TokenType.RPAREN, _tokenizer.TokenType.LBRACK, _tokenizer.TokenType.RBRACK, _tokenizer.TokenType.LBRACE, _tokenizer.TokenType.RBRACE, _tokenizer.TokenType.COLON, _tokenizer.TokenType.SEMICOLON, _tokenizer.TokenType.PERIOD, _tokenizer.TokenType.ELLIPSIS, _tokenizer.TokenType.ARROW, _tokenizer.TokenType.CONDITIONAL, _tokenizer.TokenType.INC, _tokenizer.TokenType.DEC, _tokenizer.TokenType.ASSIGN, _tokenizer.TokenType.ASSIGN_BIT_OR, _tokenizer.TokenType.ASSIGN_BIT_XOR, _tokenizer.TokenType.ASSIGN_BIT_AND, _tokenizer.TokenType.ASSIGN_SHL, _tokenizer.TokenType.ASSIGN_SHR, _tokenizer.TokenType.ASSIGN_SHR_UNSIGNED, _tokenizer.TokenType.ASSIGN_ADD, _tokenizer.TokenType.ASSIGN_SUB, _tokenizer.TokenType.ASSIGN_MUL, _tokenizer.TokenType.ASSIGN_DIV, _tokenizer.TokenType.ASSIGN_MOD, _tokenizer.TokenType.COMMA, _tokenizer.TokenType.OR, _tokenizer.TokenType.AND, _tokenizer.TokenType.BIT_OR, _tokenizer.TokenType.BIT_XOR, _tokenizer.TokenType.BIT_AND, _tokenizer.TokenType.SHL, _tokenizer.TokenType.SHR, _tokenizer.TokenType.SHR_UNSIGNED, _tokenizer.TokenType.ADD, _tokenizer.TokenType.SUB, _tokenizer.TokenType.MUL, _tokenizer.TokenType.DIV, _tokenizer.TokenType.MOD, _tokenizer.TokenType.EQ, _tokenizer.TokenType.NE, _tokenizer.TokenType.EQ_STRICT, _tokenizer.TokenType.NE_STRICT, _tokenizer.TokenType.LT, _tokenizer.TokenType.GT, _tokenizer.TokenType.LTE, _tokenizer.TokenType.GTE, _tokenizer.TokenType.INSTANCEOF, _tokenizer.TokenType.IN, _tokenizer.TokenType.NOT, _tokenizer.TokenType.BIT_NOT, _tokenizer.TokenType.AWAIT, _tokenizer.TokenType.DELETE, _tokenizer.TokenType.TYPEOF, _tokenizer.TokenType.VOID, _tokenizer.TokenType.BREAK, _tokenizer.TokenType.CASE, _tokenizer.TokenType.CATCH, _tokenizer.TokenType.CLASS, _tokenizer.TokenType.CONTINUE, _tokenizer.TokenType.DEBUGGER, _tokenizer.TokenType.DEFAULT, _tokenizer.TokenType.DO, _tokenizer.TokenType.ELSE, _tokenizer.TokenType.EXPORT, _tokenizer.TokenType.EXTENDS, _tokenizer.TokenType.FINALLY, _tokenizer.TokenType.FOR, _tokenizer.TokenType.FUNCTION, _tokenizer.TokenType.IF, _tokenizer.TokenType.IMPORT, _tokenizer.TokenType.LET, _tokenizer.TokenType.NEW, _tokenizer.TokenType.RETURN, _tokenizer.TokenType.SUPER, _tokenizer.TokenType.SWITCH, _tokenizer.TokenType.THIS, _tokenizer.TokenType.THROW, _tokenizer.TokenType.TRY, _tokenizer.TokenType.VAR, _tokenizer.TokenType.WHILE, _tokenizer.TokenType.WITH, _tokenizer.TokenType.NULL, _tokenizer.TokenType.TRUE, _tokenizer.TokenType.FALSE, _tokenizer.TokenType.YIELD, _tokenizer.TokenType.NUMBER, _tokenizer.TokenType.STRING, _tokenizer.TokenType.REGEXP, _tokenizer.TokenType.IDENTIFIER, _tokenizer.TokenType.CONST, _tokenizer.TokenType.TEMPLATE, _tokenizer.TokenType.ILLEGAL];
var ListHandler_495 = _transitJs2.default.makeWriteHandler({ tag: function tag() {
    return "array";
  }, rep: function rep(v_501) {
    return v_501;
  } });
var MapHandler_496 = _transitJs2.default.makeWriteHandler({ tag: function tag(v_502) {
    return "map";
  }, rep: function rep(v_503) {
    return v_503;
  }, stringRep: function stringRep(v_504) {
    return null;
  } });
var SyntaxHandler_497 = _transitJs2.default.makeWriteHandler({ tag: function tag() {
    return "stx";
  }, rep: function rep(v_505) {
    if (_immutable.List.isList(v_505.token)) {
      return [v_505.token, v_505.scopesets];
    } else {
      var t = _transitJs2.default.objectToMap(v_505.token);
      t.set("type", typeMap_494.indexOf(v_505.token.type));
      return [t, v_505.scopesets];
    }
  } });
var SymbolHandler_498 = _transitJs2.default.makeWriteHandler({ tag: function tag() {
    return "symb";
  }, rep: function rep(v_506) {
    return [v_506.name];
  } });
var writer_499 = _transitJs2.default.writer("json", { handlers: _transitJs2.default.map([_immutable.List, ListHandler_495, _immutable.Map, MapHandler_496, _syntax2.default, SyntaxHandler_497, _symbol.SymbolClass, SymbolHandler_498]) });
function makeReader_500(bindings_507) {
  return _transitJs2.default.reader("json", { arrayBuilder: { init: function init(node_508) {
        return (0, _immutable.List)().asMutable();
      }, add: function add(ret_509, val_510, node_511) {
        return ret_509.push(val_510);
      }, finalize: function finalize(ret_512, node_513) {
        return ret_512.asImmutable();
      }, fromArray: function fromArray(arr_514, node_515) {
        return (0, _immutable.List)(arr_514);
      } }, mapBuilder: { init: function init(node_516) {
        return (0, _immutable.Map)().asMutable();
      }, add: function add(ret_517, key_518, val_519, node_520) {
        return ret_517.set(key_518, val_519);
      }, finalize: function finalize(ret_521, node_522) {
        return ret_521.asImmutable();
      } }, handlers: { stx: function stx(rep_523) {
        var scopesets_524 = _transitJs2.default.mapToObject(rep_523[1]);
        if (_immutable.List.isList(rep_523[0])) {
          var token = rep_523[0];
          return new _syntax2.default(token, { bindings: bindings_507, scopesets: scopesets_524 });
        } else {
          var _token = _transitJs2.default.mapToObject(rep_523[0]);
          _token.type = typeMap_494[rep_523[0].get("type")];
          _token.slice = rep_523[0].has("slice") ? _transitJs2.default.mapToObject(rep_523[0].get("slice")) : undefined;
          return new _syntax2.default(_token, { bindings: bindings_507, scopesets: scopesets_524 });
        }
      }, symb: function symb(rep_525) {
        return (0, _symbol.Symbol)(rep_525[0]);
      } } });
}
exports.makeDeserializer = makeReader_500;
exports.serializer = writer_499;
//# sourceMappingURL=data:application/json;base64,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QyxlQUFPLFFBQVEsV0FBUixFQUFQO0FBQ0QsT0FOcVEsRUFBeE8sRUFNMUIsVUFBVSxFQUFDLEtBQUssc0JBQVc7QUFDN0IsWUFBSSxnQkFBZ0Isb0JBQVEsV0FBUixDQUFvQixRQUFRLENBQVIsQ0FBcEIsQ0FBcEI7QUFDQSxZQUFJLGdCQUFLLE1BQUwsQ0FBWSxRQUFRLENBQVIsQ0FBWixDQUFKLEVBQTZCO0FBQzNCLGNBQUksUUFBUSxRQUFRLENBQVIsQ0FBWjtBQUNBLGlCQUFPLHFCQUFXLEtBQVgsRUFBa0IsRUFBQyxVQUFVLFlBQVgsRUFBeUIsV0FBVyxhQUFwQyxFQUFsQixDQUFQO0FBQ0QsU0FIRCxNQUdPO0FBQ0wsY0FBSSxTQUFRLG9CQUFRLFdBQVIsQ0FBb0IsUUFBUSxDQUFSLENBQXBCLENBQVo7QUFDQSxpQkFBTSxJQUFOLEdBQWEsWUFBWSxRQUFRLENBQVIsRUFBVyxHQUFYLENBQWUsTUFBZixDQUFaLENBQWI7QUFDQSxpQkFBTSxLQUFOLEdBQWMsUUFBUSxDQUFSLEVBQVcsR0FBWCxDQUFlLE9BQWYsSUFBMEIsb0JBQVEsV0FBUixDQUFvQixRQUFRLENBQVIsRUFBVyxHQUFYLENBQWUsT0FBZixDQUFwQixDQUExQixHQUF5RSxTQUF2RjtBQUNBLGlCQUFPLHFCQUFXLE1BQVgsRUFBa0IsRUFBQyxVQUFVLFlBQVgsRUFBeUIsV0FBVyxhQUFwQyxFQUFsQixDQUFQO0FBQ0Q7QUFDRixPQVhhLEVBV1gsTUFBTSx1QkFBVztBQUNsQixlQUFPLG9CQUFPLFFBQVEsQ0FBUixDQUFQLENBQVA7QUFDRCxPQWJhLEVBTmdCLEVBQXZCLENBQVA7QUFvQkQ7UUFDeUIsZ0IsR0FBbEIsYztRQUFrRCxVLEdBQWQsVSIsImZpbGUiOiJzZXJpYWxpemVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHRyYW5zaXQgZnJvbSBcInRyYW5zaXQtanNcIjtcbmltcG9ydCB7TGlzdCwgTWFwfSBmcm9tIFwiaW1tdXRhYmxlXCI7XG5pbXBvcnQgU3ludGF4IGZyb20gXCIuL3N5bnRheFwiO1xuaW1wb3J0IHtTeW1ib2wsIGdlbnN5bSwgU3ltYm9sQ2xhc3N9IGZyb20gXCIuL3N5bWJvbFwiO1xuaW1wb3J0IHtUb2tlbkNsYXNzLCBUb2tlblR5cGV9IGZyb20gXCJzaGlmdC1wYXJzZXIvZGlzdC90b2tlbml6ZXJcIjtcbmxldCB0eXBlTWFwXzQ5NCA9IFtUb2tlblR5cGUuU1RSSU5HLCBUb2tlblR5cGUuRU9TLCBUb2tlblR5cGUuTFBBUkVOLCBUb2tlblR5cGUuUlBBUkVOLCBUb2tlblR5cGUuTEJSQUNLLCBUb2tlblR5cGUuUkJSQUNLLCBUb2tlblR5cGUuTEJSQUNFLCBUb2tlblR5cGUuUkJSQUNFLCBUb2tlblR5cGUuQ09MT04sIFRva2VuVHlwZS5TRU1JQ09MT04sIFRva2VuVHlwZS5QRVJJT0QsIFRva2VuVHlwZS5FTExJUFNJUywgVG9rZW5UeXBlLkFSUk9XLCBUb2tlblR5cGUuQ09ORElUSU9OQUwsIFRva2VuVHlwZS5JTkMsIFRva2VuVHlwZS5ERUMsIFRva2VuVHlwZS5BU1NJR04sIFRva2VuVHlwZS5BU1NJR05fQklUX09SLCBUb2tlblR5cGUuQVNTSUdOX0JJVF9YT1IsIFRva2VuVHlwZS5BU1NJR05fQklUX0FORCwgVG9rZW5UeXBlLkFTU0lHTl9TSEwsIFRva2VuVHlwZS5BU1NJR05fU0hSLCBUb2tlblR5cGUuQVNTSUdOX1NIUl9VTlNJR05FRCwgVG9rZW5UeXBlLkFTU0lHTl9BREQsIFRva2VuVHlwZS5BU1NJR05fU1VCLCBUb2tlblR5cGUuQVNTSUdOX01VTCwgVG9rZW5UeXBlLkFTU0lHTl9ESVYsIFRva2VuVHlwZS5BU1NJR05fTU9ELCBUb2tlblR5cGUuQ09NTUEsIFRva2VuVHlwZS5PUiwgVG9rZW5UeXBlLkFORCwgVG9rZW5UeXBlLkJJVF9PUiwgVG9rZW5UeXBlLkJJVF9YT1IsIFRva2VuVHlwZS5CSVRfQU5ELCBUb2tlblR5cGUuU0hMLCBUb2tlblR5cGUuU0hSLCBUb2tlblR5cGUuU0hSX1VOU0lHTkVELCBUb2tlblR5cGUuQURELCBUb2tlblR5cGUuU1VCLCBUb2tlblR5cGUuTVVMLCBUb2tlblR5cGUuRElWLCBUb2tlblR5cGUuTU9ELCBUb2tlblR5cGUuRVEsIFRva2VuVHlwZS5ORSwgVG9rZW5UeXBlLkVRX1NUUklDVCwgVG9rZW5UeXBlLk5FX1NUUklDVCwgVG9rZW5UeXBlLkxULCBUb2tlblR5cGUuR1QsIFRva2VuVHlwZS5MVEUsIFRva2VuVHlwZS5HVEUsIFRva2VuVHlwZS5JTlNUQU5DRU9GLCBUb2tlblR5cGUuSU4sIFRva2VuVHlwZS5OT1QsIFRva2VuVHlwZS5CSVRfTk9ULCBUb2tlblR5cGUuQVdBSVQsIFRva2VuVHlwZS5ERUxFVEUsIFRva2VuVHlwZS5UWVBFT0YsIFRva2VuVHlwZS5WT0lELCBUb2tlblR5cGUuQlJFQUssIFRva2VuVHlwZS5DQVNFLCBUb2tlblR5cGUuQ0FUQ0gsIFRva2VuVHlwZS5DTEFTUywgVG9rZW5UeXBlLkNPTlRJTlVFLCBUb2tlblR5cGUuREVCVUdHRVIsIFRva2VuVHlwZS5ERUZBVUxULCBUb2tlblR5cGUuRE8sIFRva2VuVHlwZS5FTFNFLCBUb2tlblR5cGUuRVhQT1JULCBUb2tlblR5cGUuRVhURU5EUywgVG9rZW5UeXBlLkZJTkFMTFksIFRva2VuVHlwZS5GT1IsIFRva2VuVHlwZS5GVU5DVElPTiwgVG9rZW5UeXBlLklGLCBUb2tlblR5cGUuSU1QT1JULCBUb2tlblR5cGUuTEVULCBUb2tlblR5cGUuTkVXLCBUb2tlblR5cGUuUkVUVVJOLCBUb2tlblR5cGUuU1VQRVIsIFRva2VuVHlwZS5TV0lUQ0gsIFRva2VuVHlwZS5USElTLCBUb2tlblR5cGUuVEhST1csIFRva2VuVHlwZS5UUlksIFRva2VuVHlwZS5WQVIsIFRva2VuVHlwZS5XSElMRSwgVG9rZW5UeXBlLldJVEgsIFRva2VuVHlwZS5OVUxMLCBUb2tlblR5cGUuVFJVRSwgVG9rZW5UeXBlLkZBTFNFLCBUb2tlblR5cGUuWUlFTEQsIFRva2VuVHlwZS5OVU1CRVIsIFRva2VuVHlwZS5TVFJJTkcsIFRva2VuVHlwZS5SRUdFWFAsIFRva2VuVHlwZS5JREVOVElGSUVSLCBUb2tlblR5cGUuQ09OU1QsIFRva2VuVHlwZS5URU1QTEFURSwgVG9rZW5UeXBlLklMTEVHQUxdO1xubGV0IExpc3RIYW5kbGVyXzQ5NSA9IHRyYW5zaXQubWFrZVdyaXRlSGFuZGxlcih7dGFnOiAoKSA9PiBcImFycmF5XCIsIHJlcDogdl81MDEgPT4gdl81MDF9KTtcbmxldCBNYXBIYW5kbGVyXzQ5NiA9IHRyYW5zaXQubWFrZVdyaXRlSGFuZGxlcih7dGFnOiBmdW5jdGlvbiAodl81MDIpIHtcbiAgcmV0dXJuIFwibWFwXCI7XG59LCByZXA6IGZ1bmN0aW9uICh2XzUwMykge1xuICByZXR1cm4gdl81MDM7XG59LCBzdHJpbmdSZXA6IGZ1bmN0aW9uICh2XzUwNCkge1xuICByZXR1cm4gbnVsbDtcbn19KTtcbmxldCBTeW50YXhIYW5kbGVyXzQ5NyA9IHRyYW5zaXQubWFrZVdyaXRlSGFuZGxlcih7dGFnOiAoKSA9PiBcInN0eFwiLCByZXA6IHZfNTA1ID0+IHtcbiAgaWYgKExpc3QuaXNMaXN0KHZfNTA1LnRva2VuKSkge1xuICAgIHJldHVybiBbdl81MDUudG9rZW4sIHZfNTA1LnNjb3Blc2V0c107XG4gIH0gZWxzZSB7XG4gICAgbGV0IHQgPSB0cmFuc2l0Lm9iamVjdFRvTWFwKHZfNTA1LnRva2VuKTtcbiAgICB0LnNldChcInR5cGVcIiwgdHlwZU1hcF80OTQuaW5kZXhPZih2XzUwNS50b2tlbi50eXBlKSk7XG4gICAgcmV0dXJuIFt0LCB2XzUwNS5zY29wZXNldHNdO1xuICB9XG59fSk7XG5sZXQgU3ltYm9sSGFuZGxlcl80OTggPSB0cmFuc2l0Lm1ha2VXcml0ZUhhbmRsZXIoe3RhZzogKCkgPT4gXCJzeW1iXCIsIHJlcDogdl81MDYgPT4gW3ZfNTA2Lm5hbWVdfSk7XG5sZXQgd3JpdGVyXzQ5OSA9IHRyYW5zaXQud3JpdGVyKFwianNvblwiLCB7aGFuZGxlcnM6IHRyYW5zaXQubWFwKFtMaXN0LCBMaXN0SGFuZGxlcl80OTUsIE1hcCwgTWFwSGFuZGxlcl80OTYsIFN5bnRheCwgU3ludGF4SGFuZGxlcl80OTcsIFN5bWJvbENsYXNzLCBTeW1ib2xIYW5kbGVyXzQ5OF0pfSk7XG5mdW5jdGlvbiBtYWtlUmVhZGVyXzUwMChiaW5kaW5nc181MDcpIHtcbiAgcmV0dXJuIHRyYW5zaXQucmVhZGVyKFwianNvblwiLCB7YXJyYXlCdWlsZGVyOiB7aW5pdDogbm9kZV81MDggPT4gTGlzdCgpLmFzTXV0YWJsZSgpLCBhZGQ6IChyZXRfNTA5LCB2YWxfNTEwLCBub2RlXzUxMSkgPT4gcmV0XzUwOS5wdXNoKHZhbF81MTApLCBmaW5hbGl6ZTogKHJldF81MTIsIG5vZGVfNTEzKSA9PiByZXRfNTEyLmFzSW1tdXRhYmxlKCksIGZyb21BcnJheTogKGFycl81MTQsIG5vZGVfNTE1KSA9PiBMaXN0KGFycl81MTQpfSwgbWFwQnVpbGRlcjoge2luaXQ6IGZ1bmN0aW9uIChub2RlXzUxNikge1xuICAgIHJldHVybiBNYXAoKS5hc011dGFibGUoKTtcbiAgfSwgYWRkOiBmdW5jdGlvbiAocmV0XzUxNywga2V5XzUxOCwgdmFsXzUxOSwgbm9kZV81MjApIHtcbiAgICByZXR1cm4gcmV0XzUxNy5zZXQoa2V5XzUxOCwgdmFsXzUxOSk7XG4gIH0sIGZpbmFsaXplOiBmdW5jdGlvbiAocmV0XzUyMSwgbm9kZV81MjIpIHtcbiAgICByZXR1cm4gcmV0XzUyMS5hc0ltbXV0YWJsZSgpO1xuICB9fSwgaGFuZGxlcnM6IHtzdHg6IHJlcF81MjMgPT4ge1xuICAgIGxldCBzY29wZXNldHNfNTI0ID0gdHJhbnNpdC5tYXBUb09iamVjdChyZXBfNTIzWzFdKTtcbiAgICBpZiAoTGlzdC5pc0xpc3QocmVwXzUyM1swXSkpIHtcbiAgICAgIGxldCB0b2tlbiA9IHJlcF81MjNbMF07XG4gICAgICByZXR1cm4gbmV3IFN5bnRheCh0b2tlbiwge2JpbmRpbmdzOiBiaW5kaW5nc181MDcsIHNjb3Blc2V0czogc2NvcGVzZXRzXzUyNH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBsZXQgdG9rZW4gPSB0cmFuc2l0Lm1hcFRvT2JqZWN0KHJlcF81MjNbMF0pO1xuICAgICAgdG9rZW4udHlwZSA9IHR5cGVNYXBfNDk0W3JlcF81MjNbMF0uZ2V0KFwidHlwZVwiKV07XG4gICAgICB0b2tlbi5zbGljZSA9IHJlcF81MjNbMF0uaGFzKFwic2xpY2VcIikgPyB0cmFuc2l0Lm1hcFRvT2JqZWN0KHJlcF81MjNbMF0uZ2V0KFwic2xpY2VcIikpIDogdW5kZWZpbmVkO1xuICAgICAgcmV0dXJuIG5ldyBTeW50YXgodG9rZW4sIHtiaW5kaW5nczogYmluZGluZ3NfNTA3LCBzY29wZXNldHM6IHNjb3Blc2V0c181MjR9KTtcbiAgICB9XG4gIH0sIHN5bWI6IHJlcF81MjUgPT4ge1xuICAgIHJldHVybiBTeW1ib2wocmVwXzUyNVswXSk7XG4gIH19fSk7XG59XG5leHBvcnQge21ha2VSZWFkZXJfNTAwIGFzIG1ha2VEZXNlcmlhbGl6ZXIsIHdyaXRlcl80OTkgYXMgc2VyaWFsaXplcn07XG4iXX0=